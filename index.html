<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>æŠ•è³‡ç›£æ§ä¸­å¿ƒ</title>
  <style>
    body { font-family: system-ui, -apple-system, "Noto Sans TC", sans-serif; margin: 24px; }
    .row { display: flex; gap: 12px; flex-wrap: wrap; }
    .btn { display:inline-block; padding:10px 12px; border:1px solid #ddd; border-radius:10px; text-decoration:none; color:#111; }
    .card { border:1px solid #eee; border-radius:14px; padding:14px; margin-top:14px; }
    .muted { color:#666; font-size: 14px; }
    ul { margin: 10px 0 0 18px; }
    .tag { font-size:12px; padding:2px 8px; border:1px solid #ddd; border-radius:999px; margin-left:8px; color:#444; }
  </style>
</head>
<body>
  <h1>ğŸ“Š æˆ‘çš„æŠ•è³‡ç›£æ§ä¸­å¿ƒ</h1>

  <div class="row">
    <a class="btn" href="https://mis23ms.github.io/tw-stock-06/" target="_blank" rel="noopener">è‚¡ç¥¨å¤–è³‡æˆ°å ±</a>
    <a class="btn" href="https://mis23ms.github.io/tw-stock-futures/" target="_blank" rel="noopener">æœŸè²¨å¤§é¡äº¤æ˜“äºº</a>
    <a class="btn" href="https://mis23ms.github.io/tw-stock-options/" target="_blank" rel="noopener">é¸æ“‡æ¬Šå¤§é¡äº¤æ˜“äºº</a>
  </div>

  <div class="card">
    <h2>âš ï¸ ä»Šæ—¥é‡é»</h2>
    <div id="status" class="muted">è¼‰å…¥ä¸­â€¦</div>
    <ul id="highlights"></ul>
  </div>

  <div class="card">
    <h2>ğŸ•’ æœ€æ–°æ›´æ–°</h2>
    <div id="updatedAt" class="muted">â€”</div>
  </div>

<script>
  // ä½ ä¸‰å€‹å°ˆæ¡ˆå„è‡ªè¦æä¾›å›ºå®šä½ç½®çš„ summary.json
  const SOURCES = [
    { name: "è‚¡ç¥¨å¤–è³‡æˆ°å ±", url: "https://mis23ms.github.io/tw-stock-06/summary.json", key: "stock06" },
    { name: "æœŸè²¨å¤§é¡äº¤æ˜“äºº", url: "https://mis23ms.github.io/tw-stock-futures/summary.json", key: "futures" },
    { name: "é¸æ“‡æ¬Šå¤§é¡äº¤æ˜“äºº", url: "https://mis23ms.github.io/tw-stock-options/summary.json", key: "options" },
  ];

  const $status = document.getElementById("status");
  const $list = document.getElementById("highlights");
  const $updatedAt = document.getElementById("updatedAt");

  function li(text, sourceName) {
    const el = document.createElement("li");
    el.textContent = text;
    const tag = document.createElement("span");
    tag.className = "tag";
    tag.textContent = sourceName;
    el.appendChild(tag);
    return el;
  }

  async function loadAll() {
    $status.textContent = "è¼‰å…¥ä¸­â€¦";
    $list.innerHTML = "";
    let latestTs = null;
    let totalItems = 0;

    const results = await Promise.allSettled(
      SOURCES.map(s => fetch(s.url, { cache: "no-store" }).then(r => {
        if (!r.ok) throw new Error(`${r.status} ${r.statusText}`);
        return r.json();
      }).then(json => ({ source: s, json })))
    );

    for (const r of results) {
      if (r.status === "fulfilled") {
        const { source, json } = r.value;

        // å»ºè­° summary.json æ ¼å¼ï¼š{ updatedAt: "2026-01-30 17:20", highlights: ["...","..."] }
        const items = Array.isArray(json.highlights) ? json.highlights : [];
        items.forEach(t => { $list.appendChild(li(t, source.name)); });
        totalItems += items.length;

        if (json.updatedAt) {
          // ç”¨å­—ä¸²æ¯”å¤§å°å³å¯ï¼ˆä½ è‹¥ç”¨ YYYY-MM-DD HH:mm æ ¼å¼ï¼‰
          latestTs = (latestTs === null || json.updatedAt > latestTs) ? json.updatedAt : latestTs;
        }
      } else {
        // æŸå€‹ä¾†æºæ›äº†ä¹Ÿä¸å½±éŸ¿æ•´é«”
        $list.appendChild(li(`ï¼ˆæŠ“ä¸åˆ° ${r.reason?.message || "è³‡æ–™"}ï¼‰`, "ç¸½è¦½"));
      }
    }

    $updatedAt.textContent = latestTs ? latestTs : "â€”";
    $status.textContent = totalItems ? `å…± ${totalItems} å‰‡é‡é»` : "ç›®å‰æ²’æœ‰é‡é»ï¼ˆæˆ– summary.json å°šæœªå»ºç«‹ï¼‰";
  }

  loadAll();
</script>
</body>
</html>
